from .third_party import ox, np, Polygon, 

def river(*args): #, buffer = None):
    tags = {'waterway': 'river'}
    river_data = []
    #The following print the geometries ('geometries') and the geometry that is interested as a Polygon ('polygon'). 
    #If no rivers are present in the location, the code will stop and not print out results
    if len(args) == 1 and isinstance(args[0], str):
        name = args[0]
        print(f'Processing rivers in: {name}')
        geometries = ox.geometries_from_place(name, tags=tags)
        
        shape = ox.geometries_from_place(name, tags={'name': name})
        polygon = shape.unary_union
                
        if len(geometries) == 0:
            print(f'No rivers found in {name}')
            exit
        else:
            river_data.append((name, geometries))
    elif len(args) == 4:
        print('Processing rivers in lat long grid')
        geometries = ox.geometries_from_bbox(args[0], args[1], args[2], args[3], tags=tags)
        
        polygon= Polygon([(args[3],args[1]),(args[3],args[0]),(args[2],args[0]),(args[2],args[1])])
        
        if len(geometries) == 0:
            print('No rivers found in grid')
            exit
        else:
            river_data.append(('LatLongGrid', geometries))
            
    #This is for when the wrong number of arguments is passed
    else:
        print('Argument is not callable. Either-')
        print('        4 values: lat1, lat2, lon1, lon2')
        print('        1 value: The name of a given area')
        
    unique_names = river_data[0][1]['name'].dropna().unique()
    
    print(river_data[0][1]['name'].nunique(), 'Unique Rivers Extracted:')
    for value in unique_names:
        print('      ', value)
    return river_data[0][1][['geometry', 'name']], polygon


   
